<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>The Builder Pattern in Laravel</title> <meta name="description" content="Wow I should have waited another 10 days so I could have written a newblog post on the 1 year anniversary of not writing in my blog‚Ä¶ jk. Ialso like how my la..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://snags88.github.io/builder-pattern-in-laravel"> <link rel="alternate" type="application/rss+xml" title="gem install Seiji" href="http://snags88.github.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="no-style primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">The Builder Pattern in Laravel</h1> <p class="post-meta"><time datetime="2018-05-14T17:51:00-07:00" itemprop="datePublished">May 14, 2018</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>Wow I should have waited another 10 days so I could have written a new blog post on the 1 year anniversary of not writing in my blog‚Ä¶ jk. I also like how my last post was about trying to learn Python and now I‚Äôm talking about PHP. I guess a quick catch up of what happened over the last year:</p> <ul> <li>I left Flatiron School last May.</li> <li>I started at Curology in July where I work in the Laravel framework (PHP) and React + MobX on the front-end.</li> <li>Also just attended a conference last week and realized I‚Äôve been slacking off since I started at Curology hence the sudden revival of the blog.</li> <li>Between July and last week, I‚Äôve been on a quest to find the holy grail and fight off vicious dragons‚Ä¶ where holy grail = PHP/Laravel knowledge and vicious dragons = random bugs that I probably caused myself.</li> </ul> <p>In any case, felt like I should get back into the good ol‚Äô technical writing. And since I already know that I‚Äôm going to have trouble writing consistently, I decided to choose a theme to provide me blogging topics for the next few weeks (months? üò±). My writing topic will be‚Ä¶</p> <p><strong>DRUMROLL</strong></p> <p>to find each of the <a href="https://en.wikipedia.org/wiki/Design_Patterns" target="_blank">Design Patterns from the Gang of Four</a> in the Laravel ecosystem.</p> <p>So without further ado, here we gooooooo!</p> <h2 id="builder-pattern">Builder Pattern</h2> <p>The first pattern I‚Äôll talk about is probably one of my favorites and it‚Äôs called the builder pattern. By definition, the builder pattern is a creational pattern, where the whole idea is that we‚Äôre going to be creating a new object that fits our needs. In our code, we‚Äôll just call methods on the builder to end up with the exact object we want. To see more of the technical definition, you can visit the <a href="https://en.wikipedia.org/wiki/Builder_pattern" target="_blank">wikipedia page here</a>.</p> <p>As pseudo code, it might look something like this:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$train</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">TrainBuilder</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addEngines</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addPassengers</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addLuggageCars</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">getTrain</span><span class="p">();</span></code></pre></figure> <p>We have a builder where we can mutate what we‚Äôre building by using its public API.</p> <p>LOOK AT HOW FLUENT THE CODE IS. LOOK AT IT ü§©</p> <p>So simple to read and abstracts away what‚Äôs happening so we don‚Äôt care how the passangers are being added. Just that they are added to the train! The implementation of the builder might look something like this:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">TrainBuilder</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$train</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">train</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Train</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addEngines</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$engines</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">train</span><span class="o">-&gt;</span><span class="na">engines</span> <span class="o">=</span> <span class="nv">$engines</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addPassengers</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$passengers</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$passengers</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">train</span><span class="o">-&gt;</span><span class="na">addPassenger</span><span class="p">(</span><span class="k">new</span> <span class="nx">Passenger</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">addLuggageCars</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$cars</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">train</span><span class="o">-&gt;</span><span class="na">luggageCars</span> <span class="o">=</span> <span class="nv">$cars</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTrain</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">train</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>Notice the process of adding passangers is different, but as I mentioned above, its abstracted away from the rest of the world and the builder object has a nice API that‚Äôs uniform and predictable. Another thing to note is that we‚Äôre returning <code class="highlighter-rouge">$this</code> on the methods so that it‚Äôs chainable. I‚Äôm pretty sure there‚Äôs a fancy term for it, but I‚Äôll just call it chainable for now.</p> <h2 id="builder-pattern-in-the-wild-">Builder Pattern in the Wild üïµÔ∏è</h2> <p>Alright, this is hella cheating because we don‚Äôt have to look much further than Laravel to find the builder pattern in action. Laravel‚Äôs ORM, <em>Eloquent</em>, uses the builder pattern in‚Ä¶ yup you guessed it, the query builder.</p> <p>The query builder is the object that gets returned anytime you‚Äôre doing a query on an Eloquent Model like this:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'&lt;'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">'created_at'</span><span class="p">,</span> <span class="s1">'desc'</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span></code></pre></figure> <p>And as the name suggests, you can continue to build queries like complex joins or conditional wheres. Once you‚Äôre done building your query, you can call any of the fetching methods like <code class="highlighter-rouge">get()</code> or <code class="highlighter-rouge">first()</code> to run the query against the database and get a collection or single record.</p> <p>It‚Äôs actually a pretty common pattern for ORMs to have chainable methods to build a query. You can see ActiveRecord in Rails also use this pattern in their <a href="http://guides.rubyonrails.org/active_record_querying.html#understanding-the-method-chaining" target="_blank">documentation</a>.</p> <p>If we take a look at the implementation of the <code class="highlighter-rouge">QueryBuilder</code>methods used in the example code, we can see that it is similar to our <code class="highlighter-rouge">TrainBuilder</code> example. It returns <code class="highlighter-rouge">$this</code> and mutates its own properties:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// code from https://github.com/laravel/framework/blob/f91e049f9c7b97e0e85d56961d1eeae82a1815a2/src/Illuminate/Database/Query/Builder.php
</span>
<span class="k">class</span> <span class="nc">Builder</span>
<span class="p">{</span>
    <span class="c1">// A bunch of other Builder function implementations
</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">where</span><span class="p">(</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$operator</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nv">$value</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nv">$boolean</span> <span class="o">=</span> <span class="s1">'and'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Some code handling specific conditions and
</span>
        <span class="c1">// delegating to helper functions
</span>

        <span class="nv">$type</span> <span class="o">=</span> <span class="s1">'Basic'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">wheres</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">compact</span><span class="p">(</span>
            <span class="s1">'type'</span><span class="p">,</span> <span class="s1">'column'</span><span class="p">,</span> <span class="s1">'operator'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="s1">'boolean'</span>
        <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$value</span> <span class="nx">instanceof</span> <span class="nx">Expression</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addBinding</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="s1">'where'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">orderBy</span><span class="p">(</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$direction</span> <span class="o">=</span> <span class="s1">'asc'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unions</span> <span class="o">?</span> <span class="s1">'unionOrders'</span> <span class="o">:</span> <span class="s1">'orders'</span><span class="p">}[]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">'column'</span> <span class="o">=&gt;</span> <span class="nv">$column</span><span class="p">,</span>
            <span class="s1">'direction'</span> <span class="o">=&gt;</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$direction</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'asc'</span> <span class="o">?</span> <span class="s1">'asc'</span> <span class="o">:</span> <span class="s1">'desc'</span><span class="p">,</span>
        <span class="p">];</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">limit</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$property</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unions</span> <span class="o">?</span> <span class="s1">'unionLimit'</span> <span class="o">:</span> <span class="s1">'limit'</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$property</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>Alright did I blow your mind yet? I hope so because I have nothing else left to show you üòÇ. I hope this example of a builder pattern in the wild shows you the usage and implementation. The builder pattern isn‚Äôt for every occasion, but when you have something that needs to be built differently based on the context of the code, it‚Äôs a pretty good sign to reach for this pattern.</p> <p>At Curology, we recently implemented the builder pattern to handle searching for our bottle shipments from the front end. Based on different queries passed in by the admin, we built the shipment query properly. That builder is now reusable across multiple locations in our app.</p> <p>Anyway, thanks for reading and happy coding!</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2018 All rights reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/nandomoreirame/dotX" target="_blank">dotX</a> theme.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html>